-file("anon_struct_mod1.erl", 1).

-module(anon_struct_mod1).

-export([test/0,test_in_lc/1]).

test() ->
    [ 
     (test(X)) ||
         X <-
             [#{},
              #{a => 1, b => 2},
              (#{a => 1, b => 2})#{},
              ((#{a => 1})#{b => 2})#{},
              (#{})#{a => 1, b => #{c => 2, d => 3}},
              map_get(a, #{a => 1, b => 2}),
              map_get(a, (#{a => 1})#{b => 2}),
              (map_get(c,
                       map_get(b,
                               (#{})#{a => 1, b => #{c => 2, d => 3}})))#{e => 4}]
    ].

-spec test(#{a := 1, b := #{c := 2, atom() => any()}, atom() => any()}) ->
              really_ok;
          (#{atom() => any()}) -> ok;
          (any()) -> not_ok.

test(A) when A =:= #{a => 1, b => #{c => 2}} ->
    closed_ok;
test(#{a := 1, b := #{c := 2}}) ->
    open_ok;
test(A) when map_get(b, A) =:= 2 ->
    ok;
test(A) when A =:= (#{a => 1})#{b => 2} ->
    ok;
test(#{a := 1}) ->
    ok;
test(#{}) ->
    ok;
test(_) ->
    not_ok.

test_in_lc(List) ->
    [ 
     Id ||
         #{id := Id} <- List
    ].



