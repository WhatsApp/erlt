# Code generated by dhall-to-yaml.  DO NOT EDIT.
jobs:
  buildJar:
    runs-on: ubuntu-latest
    steps:
      - uses: "actions/checkout@v1"
      - name: Set up Java
        uses: "actions/setup-java@v1"
        with:
          java-version: '11'
      - name: assembly sterlang.jar
        run: "cd sterlang; sbt assembly"
      - name: upload sterlang.jar
        uses: "actions/upload-artifact@v2"
        with:
          name: sterlang.jar
          path: sterlang/target/scala-2.13/sterlang.jar
  mac:
    needs:
      - buildJar
    runs-on: macos-latest
    steps:
      - uses: "actions/checkout@v1"
      - name: Set up Java
        uses: "actions/setup-java@v1"
        with:
          java-version: '11'
      - name: Setup GraalVM Environment
        uses: "DeLaGuardo/setup-graalvm@2.0"
        with:
          graalvm-version: "20.1.0.java11"
      - name: Install Native Image Plugin
        run: gu install native-image
      - name: Get JAR Artifact
        uses: "actions/download-artifact@v2"
        with:
          name: sterlang.jar
      - name: ls
        run: ls -lah
      - name: "Build native image 'sterlang-mac-release'"
        run: native-image --no-server --no-fallback -O4 -jar sterlang.jar sterlang-mac-release
      - name: upload artifacts
        uses: "actions/upload-artifact@v2"
        with:
          name: sterlang-mac-release
          path: sterlang-mac-release
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: "actions/checkout@v1"
      - name: Set up Java
        uses: "actions/setup-java@v1"
        with:
          java-version: '11'
      - name: Erlang version
        run: "erl -eval 'erlang:display(erlang:system_info(otp_release)), halt().'  -noshell"
      - name: test and coverage
        run: "cd sterlang; sbt clean coverage test coverageReport"
      - name: test
        run: "cd ./examples && make test"
  ubuntu:
    needs:
      - buildJar
    runs-on: ubuntu-latest
    steps:
      - uses: "actions/checkout@v1"
      - name: Set up Java
        uses: "actions/setup-java@v1"
        with:
          java-version: '11'
      - name: Setup GraalVM Environment
        uses: "DeLaGuardo/setup-graalvm@2.0"
        with:
          graalvm-version: "20.1.0.java11"
      - name: Install Native Image Plugin
        run: gu install native-image
      - name: Get JAR Artifact
        uses: "actions/download-artifact@v2"
        with:
          name: sterlang.jar
      - name: ls
        run: ls -lah
      - name: "Build native image 'sterlang-linux-release'"
        run: native-image --no-server --no-fallback -O4 -jar sterlang.jar sterlang-linux-release
      - name: upload artifacts
        uses: "actions/upload-artifact@v2"
        with:
          name: sterlang-linux-release
          path: sterlang-linux-release
name: Sterlang CI Release
on:
  push:
    branches:
      - "releases/**"
