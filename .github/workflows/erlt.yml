name: ErlT CI

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      - name: Erlang version
        run:  "erl -eval 'erlang:display(erlang:system_info(otp_release)), halt().'  -noshell"
      - name: make project
        run:  make
      # - name: build sterlang backend
      #   run:  cd sterlang; sbt assembly
      - name: "examples/dev/src: make"
        run:  make -C examples/dev/src
      - name: "examples/doc/src: make"
        run:  make -C examples/doc/src
      - name: "examples/elm-core/src: make"
        run:  make -C examples/elm-core/src
      - name: "examples/dev_dots/src: make"
        run:  make -C examples/dev_dots/src
      - name: "examples/dev_enum/src: make"
        run:  make -C examples/dev_enum/src
      - name: "examples/dev_struct/src: make"
        run:  make -C examples/dev_struct/src
      - name: "examples/calc/src: make"
        run:  make -C examples/calc/src
      - name: "examples/dev/src: test-ir"
        run:  make test-ir -C examples/dev/src
      - name: "examples/doc/src: test-ir"
        run:  make test-ir -C examples/doc/src
      - name: "examples/elm-core/src: test-ir"
        run:  make test-ir -C examples/elm-core/src
      - name: "examples/dev_dots/src: test-ir"
        run:  make test-ir -C examples/dev_dots/src
      - name: "examples/dev_enum/src: test-ir"
        run:  make test-ir -C examples/dev_enum/src
      - name: "examples/calc/src: test-ir"
        run:  make test-ir -C examples/calc/src
      - name: "examples/dev_struct/src: test-ir"
        run:  make test-ir -C examples/dev_struct/src
      - name: "examples/checks/src: test"
        run:  make test -C examples/checks/src
