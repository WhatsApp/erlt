  1 -module(misc).                             |         | 
  2                                            |         | 
  3 %% The majority of these tests are just    |         | 
  4 %% to get some code coverage.              |         | 
  5 %% Many of them do not have any special me……         | 
  6                                            |         | 
  7 -compile([export_all, nowarn_export_all]). |         | 
  8                                            |         | 
  9 -import(misc_lib, [boolean_id/1]).         |         | 
 10                                            |         | 
 11 -spec test01(any()) -> number().           |         | 
 12 test01(-4 = X) -> X.                       | OK      | 
 13                                            |         | 
 14 -spec test02(any()) -> number().           |         | 
 15 test02(6 / 3 = Y) -> Y.                    | OK      | 
 16                                            |         | 
 17 -spec test03_neg(any()) -> atom().         |         | 
 18 test03_neg(-4 = X) -> X.                   | ERROR   | X. Expected: atom(), Got: number()
 19                                            |         | 
 20 -spec test04_neg(any()) -> atom().         |         | 
 21 test04_neg(6 / 3 = Y) -> Y.                | ERROR   | Y. Expected: atom(), Got: number()
 22                                            |         | 
 23 -spec test05_neg(any()) -> any().          |         | 
 24 test05_neg(X) -> + X.                      | ERROR   | X. Expected: number(), Got: term()
 25                                            |         | 
 26 -spec test06_neg(any()) -> atom().         |         | 
 27 test06_neg(X) when is_number(X) -> + X.    | ERROR   | + _. Expected: atom(), Got: number()
 28                                            |         | 
 29 -spec test07(boolean()) -> atom().         |         | 
 30 test07(X) ->                               | OK      | 
 31     not X.                                 |         | 
 32                                            |         | 
 33 -spec test08_neg(boolean()) -> number().   |         | 
 34 test08_neg(X) ->                           | ERROR   | 
 35     not X.                                 |         | not _. Expected: number(), Got: 'false' | 'true'
 36                                            |         | 
 37 -spec test09(any(), any()) -> number().    |         | 
 38 test09(X, Y) when                          | OK      | 
 39     is_number(X),                          |         | 
 40     is_number(Y) -> X + Y.                 |         | 
 41                                            |         | 
 42 -spec test10_neg (any(), any())            |         | 
 43                -> number().                |         | 
 44 test10_neg(X, Y) when                      | ERROR   | 
 45     is_number(X) -> X + Y.                 |         | Y. Expected: number(), Got: term()
 46                                            |         | 
 47 -spec test11_neg (number(), number())      |         | 
 48         -> atom().                         |         | 
 49 test11_neg(X, Y) -> X + Y.                 | ERROR   | _ + _. Expected: atom(), Got: number()
 50                                            |         | 
 51 -spec test12_neg (atom())                  |         | 
 52         -> number().                       |         | 
 53 test12_neg(X) -> -X.                       | ERROR   | X. Expected: number(), Got: atom()
 54                                            |         | 
 55 -spec test13_neg (any(), any())            |         | 
 56         -> boolean().                      |         | 
 57 test13_neg(X, Y) -> X or Y.                | ERROR   | X. Expected: 'false' | 'true', Got: term()
 58                                            |         | 
 59 -spec test14 (boolean(), atom())           |         | 
 60         -> atom().                         |         | 
 61 test14(X, Y) -> X orelse Y.                | OK      | 
 62                                            |         | 
 63 -spec test15 (boolean(), atom())           |         | 
 64         -> atom().                         |         | 
 65 test15(X, Y) -> X andalso Y.               | OK      | 
 66                                            |         | 
 67 -spec test16_neg (boolean(), boolean())    |         | 
 68         -> number().                       |         | 
 69 test16_neg(X, Y) -> X or Y.                | ERROR   | _ or _. Expected: number(), Got: 'false' | 'true'
 70                                            |         | 
 71 -spec test17_neg (boolean(), atom())       |         | 
 72         -> boolean().                      |         | 
 73 test17_neg(X, Y) -> X or Y.                | ERROR   | Y. Expected: 'false' | 'true', Got: atom()
 74                                            |         | 
 75 -spec test18_neg (boolean(), atom())       |         | 
 76         -> number().                       |         | 
 77 test18_neg(X, Y) -> X orelse Y.            | ERROR   | _ orelse _. Expected: number(), Got: atom()
 78                                            |         | 
 79 -spec test19_neg (boolean(), number())     |         | 
 80         -> {number()}.                     |         | 
 81 test19_neg(X, Y) -> X andalso Y.           | ERROR   | _ andalso _. Expected: {number()}, Got: 'false' | 'true' | number()
 82                                            |         | 
 83 -spec test20_neg(number()) -> [atom()].    |         | 
 84 test20_neg(X) -> [- X].                    | ERROR   | [- _ | []]. Expected: [atom()], Got: [number()]
 85                                            |         | 
 86 -spec test21_neg (number(), number())      |         | 
 87               -> [atom()].                 |         | 
 88 test21_neg(X, Y) -> [X / Y].               | ERROR   | [_ / _ | []]. Expected: [atom()], Got: [number()]
 89                                            |         | 
 90 -spec test22_neg (boolean())               |         | 
 91         -> [number()].                     |         | 
 92 test22_neg(X) -> [not X].                  | ERROR   | [not _ | []]. Expected: [number()], Got: ['false' | 'true']
 93                                            |         | 
 94 -spec test23_neg (boolean(), boolean())    |         | 
 95         -> [number()].                     |         | 
 96 test23_neg(X, Y) -> [X or Y].              | ERROR   | [_ or _ | []]. Expected: [number()], Got: ['false' | 'true']
 97                                            |         | 
 98 -spec test24_neg (boolean(), atom())       |         | 
 99         -> [number()].                     |         | 
100 test24_neg(X, Y) -> [X orelse Y].          | ERROR   | [_ orelse _ | []]. Expected: [number()], Got: [atom()]
101                                            |         | 
102 -spec test25_pos                           |         | 
103   ([boolean()]) -> boolean() | undefined.  |         | 
104 test25_pos([]) -> undefined;               | OK      | 
105 test25_pos([X]) -> X;                      |         | 
106 test25_pos([_|T]) -> test25_pos(T).        |         | 
107                                            |         | 
108 -spec test26_pos(X) -> X.                  |         | 
109 test26_pos(X) -> X.                        | OK      | 
110                                            |         | 
111 -spec test27_pos(X) -> [X].                |         | 
112 test27_pos(X) -> [X].                      | OK      | 
113                                            |         | 
114 -spec test28_neg(atom()) -> boolean().     |         | 
115 test28_neg(B) -> boolean_id(B).            | ERROR   | B. Expected: 'false' | 'true', Got: atom()
116                                            |         | 
117 -spec test29_neg() -> [].                  |         | 
118 test29_neg() -> [true, false].             | ERROR   | ['true' | ['false' | []]]. Expected: [], Got: ['true']
119                                            |         | 
120 -spec test30_neg() -> atom.                |         | 
121 test30_neg() -> 1.                         | ERROR   | number_expr. Expected: 'atom', Got: number()
122                                            |         | 
123 -spec test31_neg() -> atom.                |         | 
124 test31_neg() -> fun test30_neg/0.          | ERROR   | test30_neg/0. Expected: 'atom', Got: fun(() -> 'atom')
125                                            |         | 
126 -spec test32_neg() -> atom.                |         | 
127 test32_neg() -> fun misc_lib:boolean_id/1. | ERROR   | misc_lib:boolean_id/1. Expected: 'atom', Got: fun(('false' | 'true') -> 'false' | 'true')
128                                            |         | 
129 -spec test33_pos(a | b, b | c) -> b.       |         | 
130 test33_pos(AB, BC) ->                      | OK      | 
131     case AB of BC -> BC end.               |         | 
132                                            |         | 
133 -spec test34_pos({a | b}, {b | c}) -> {b}. |         | 
134 test34_pos(AB, BC) ->                      | OK      | 
135     case AB of BC -> BC end.               |         | 
136                                            |         | 
137 -spec test35_pos([a | b], [b | c]) -> [b]. |         | 
138 test35_pos(AB, BC) ->                      | OK      | 
139     case AB of BC -> BC end.               |         | 
140                                            |         | 
141 -spec test36_pos(F1, F2) -> F3             |         | 
142     when F1 :: fun((a) -> a | z),          |         | 
143          F2 :: fun((b) -> b | z),          |         | 
144          F3 :: fun((a | b) -> z).          |         | 
145 test36_pos(F1, F2) ->                      | OK      | 
146     case F1 of F2 -> F2 end.               |         | 
147                                            |         | 
148 -spec test37_pos (any(), any())            |         | 
149               -> {number(), number()}.     |         | 
150 test37_pos(X, Y) when X + Y > 0 -> {X, Y}. | OK      | 
151                                            |         | 
152 -spec test38_pos (any())                   |         | 
153         -> {number()}.                     |         | 
154 test38_pos(X) when bnot X > 0 -> {X}.      | OK      | 
155                                            |         | 
156 -spec test39_pos                           |         | 
157     ({atom(), atom()} | number())          |         | 
158   -> {atom(), atom()}.                     |         | 
159 test39_pos({X, Y}) -> {X, Y};              | OK      | 
160 test39_pos(_) -> {a, b}.                   |         | 
161                                            |         | 
162 -spec test40_pos                           |         | 
163     (number()) -> {none(), none()}.        |         | 
164 test40_pos({X, Y}) -> {X, Y}.              | OK      | 
165                                            |         | 
166 -spec test41_pos                           |         | 
167     (number()) -> {none(), [none()]}.      |         | 
168 test41_pos([X | Y]) -> {X, Y}.             | OK      | 
169                                            |         | 
170 -spec test42_pos                           |         | 
171     (any()) -> {any(), [any()]}.           |         | 
172 test42_pos([X | Y]) -> {X, Y}.             | OK      | 
173                                            |         | 
174 -spec test43_pos                           |         | 
175     (any()) -> none().                     |         | 
176 test43_pos([_ | Y]) when Y + 1 > 0 -> Y.   | OK      | 
177                                            |         | 
178 -spec test44_pos(any()) -> any().          |         | 
179 test44_pos(X) ->                           | OK      | 
180     case X of                              |         | 
181         Z -> ok                            |         | 
182     end,                                   |         | 
183     Z.                                     |         | 
184                                            |         | 
185 -spec test45_pos(any()) -> atom().         |         | 
186 test45_pos(X) ->                           | OK      | 
187     case X of                              |         | 
188         _ -> Z = ok                        |         | 
189     end,                                   |         | 
190     Z.                                     |         | 
191                                            |         | 
192 -spec test46_neg() -> number().            |         | 
193 test46_neg() -> false.                     | ERROR   | 'false'. Expected: number(), Got: 'false'
194                                            |         | 
195 -spec test47_neg() -> number().            |         | 
196 test47_neg() -> [].                        | ERROR   | []. Expected: number(), Got: []
197                                            |         | 
198 -spec test48_neg() -> atom().              |         | 
199 test48_neg() -> test47_neg().              | ERROR   | test47_neg(). Expected: atom(), Got: number()
200                                            |         | 
201 -spec test49_neg() -> atom().              |         | 
202 test49_neg() -> misc:test47_neg().         | ERROR   | misc:test47_neg(). Expected: atom(), Got: number()
203                                            |         | 
204 -spec test50_pos() -> number().            |         | 
205 test50_pos() -> misc:test47_neg().         | OK      | 
206                                            |         | 
207 -spec test51_pos() -> number().            |         | 
208 test51_pos() -> test47_neg().              | OK      | 
209                                            |         | 
210 -spec test52_pos() ->                      |         | 
211       fun(() -> number()).                 |         | 
212 test52_pos() ->                            | OK      | 
213     fun test47_neg/0.                      |         | 
214                                            |         | 
215 -spec test53_pos() ->                      |         | 
216     fun(() -> number()).                   |         | 
217 test53_pos() ->                            | OK      | 
218     fun misc:test47_neg/0.                 |         | 
219                                            |         | 
220 test54_unspecced() -> ok.                  | OK      | 
221                                            |         | 
222 -spec test55_neg() ->                      |         | 
223     fun(() -> number()).                   |         | 
224 test55_neg() ->                            | ERROR   | 
225     fun misc:test54_unspecced/0.           |         | misc:test54_unspecced/0. Expected: fun(() -> number()), Got: fun
226                                            |         | 
227 -spec test56_neg() ->                      |         | 
228     fun(() -> number()).                   |         | 
229 test56_neg() ->                            | ERROR   | 
230     fun test54_unspecced/0.                |         | test54_unspecced/0. Expected: fun(() -> number()), Got: fun
231                                            |         | 
232 -spec test57_pos() -> {atom(), number()}.  |         | 
233 test57_pos() ->                            | OK      | 
234     A = atom,                              |         | 
235     N = 1,                                 |         | 
236     {A, N}.                                |         | 
237                                            |         | 
238 -spec test58_pos                           |         | 
239     (boolean(), atom(), number()) ->       |         | 
240     atom() | number().                     |         | 
241 test58_pos(B, A, N) ->                     | OK      | 
242     Res =                                  |         | 
243     begin                                  |         | 
244     if B -> A; true -> N end               |         | 
245     end,                                   |         | 
246     Res.                                   |         | 
247                                            |         | 
248 -spec test59_pos() -> number().            |         | 
249 test59_pos() ->                            | OK      | 
250     X = misc:test47_neg(),                 |         | 
251     X.                                     |         | 
252                                            |         | 
253 -spec test60_pos() -> number().            |         | 
254 test60_pos() ->                            | OK      | 
255     X = test47_neg(),                      |         | 
256     X.                                     |         | 
257                                            |         | 
258 -spec test61_neg() -> number().            |         | 
259 test61_neg() ->                            | ERROR   | 
260     X = misc:test54_unspecced(),           |         | 
261     X.                                     |         | X. Expected: number(), Got: 'ok'
262                                            |         | 
263 -spec test62_neg() -> number().            |         | 
264 test62_neg() ->                            | ERROR   | 
265     X = test54_unspecced(),                |         | 
266     X.                                     |         | X. Expected: number(), Got: 'ok'
267                                            |         | 
268 -spec test63_pos() ->                      |         | 
269     fun(() -> number()).                   |         | 
270 test63_pos() ->                            | OK      | 
271     Fun = fun misc:test47_neg/0,           |         | 
272     Fun.                                   |         | 
273                                            |         | 
274 -spec test64_pos() ->                      |         | 
275     fun(() -> number()).                   |         | 
276 test64_pos() ->                            | OK      | 
277     Fun = fun test47_neg/0,                |         | 
278     Fun.                                   |         | 
279                                            |         | 
280 -spec test65_pos() -> [any()].             |         | 
281 test65_pos() ->                            | OK      | 
282     L = [],                                |         | 
283     L.                                     |         | 
284                                            |         | 
285 -spec test66_pos() ->                      |         | 
286     {atom(), number()}.                    |         | 
287 test66_pos() ->                            | OK      | 
288     Result =                               |         | 
289         begin                              |         | 
290             X = a,                         |         | 
291             Y = 1,                         |         | 
292             {X, Y}                         |         | 
293         end,                               |         | 
294     Result.                                |         | 
295                                            |         | 
296 -spec test67_pos                           |         | 
297     (atom(), number()) ->                  |         | 
298     [atom() | number()].                   |         | 
299 test67_pos(A, N) ->                        | OK      | 
300     Result =                               |         | 
301         begin                              |         | 
302             Head = A,                      |         | 
303             Tail = [N],                    |         | 
304             [Head | Tail]                  |         | 
305         end,                               |         | 
306     Result.                                |         | 
307                                            |         | 
308 -spec test68_pos({atom()}) -> none().      |         | 
309 test68_pos({E, _}) -> E.                   | OK      | 
310                                            |         | 
311 -spec test69_pos                           |         | 
312     ([atom()] | [number()]) ->             |         | 
313     [atom() | number()].                   |         | 
314 test69_pos([H | T]) -> [H | T].            | OK      | 
315                                            |         | 
316 -spec test70_neg() ->                      |         | 
317     [atom() | number()].                   |         | 
318 test70_neg() ->                            | ERROR   | 
319     catch test69_pos([atom]).              |         | catch. Expected: [atom() | number()], Got: term()
320                                            |         | 
321 -spec test71_neg() ->                      |         | 
322     [atom() | number()].                   |         | 
323 test71_neg() ->                            | ERROR   | 
324     catch test69_pos(atom).                |         | catch. Expected: [atom() | number()], Got: term()
325                                            |         | 
326 -spec test72_neg() ->                      |         | 
327     any().                                 |         | 
328 test72_neg() ->                            | ERROR   | 
329     catch test69_pos(atom).                |         | 'atom'. Expected: [atom()] | [number()], Got: 'atom'
330                                            |         | 
331 -spec test73_pos() ->                      |         | 
332     any().                                 |         | 
333 test73_pos() ->                            | OK      | 
334     catch test69_pos([atom]).              |         | 
335                                            |         | 
336 -spec test74_pos() ->                      |         | 
337     any().                                 |         | 
338 test74_pos() ->                            | OK      | 
339     X = (catch test69_pos([atom])),        |         | 
340     X.                                     |         | 
341                                            |         | 
342 -spec test75_pos() -> ok.                  |         | 
343 test75_pos() ->                            | OK      | 
344     try                                    |         | 
345         ok                                 |         | 
346     of                                     |         | 
347         ok -> ok                           |         | 
348     after                                  |         | 
349         nook                               |         | 
350     end.                                   |         | 
351                                            |         | 
352 -spec test76_pos(any()) -> atom().         |         | 
353 test76_pos(A) when is_atom(A) -> A;        | OK      | 
354 test76_pos(_) ->                           |         | 
355     erlang:throw({error, not_an_atom}).    |         | 
356                                            |         | 
357 -spec test77_neg(any()) -> atom().         |         | 
358 test77_neg(A) -> catch(test76_pos(A)).     | ERROR   | catch. Expected: atom(), Got: term()
359                                            |         | 
360 -spec test78_pos() -> any().               |         | 
361 test78_pos() ->                            | OK      | 
362     receive                                |         | 
363         X -> X                             |         | 
364     end.                                   |         | 
365                                            |         | 
366 -spec test79_neg() -> atom().              |         | 
367 test79_neg() ->                            | ERROR   | 
368     receive                                |         | 
369         X -> X                             |         | X. Expected: atom(), Got: term()
370     end.                                   |         | 
371                                            |         | 
372 -spec test80_neg(any()) -> atom().         |         | 
373 test80_neg(Timeout) ->                     | ERROR   | 
374     receive                                |         | 
375         X -> X                             |         | X. Expected: atom(), Got: term()
376     after Timeout ->                       |         | 
377         default                            |         | 
378     end.                                   |         | 
379                                            |         | 
380 -spec test81_neg(any()) -> atom().         |         | 
381 test81_neg(Timeout) ->                     | ERROR   | 
382     receive                                |         | 
383         X when is_atom(X) -> X             |         | 
384     after Timeout ->                       |         | Timeout. Expected: number(), Got: term()
385         default                            |         | 
386     end.                                   |         | 
387                                            |         | 
388 -spec test82_pos() -> atom().              |         | 
389 test82_pos() ->                            | ERROR   | 
390     A = atom,                              |         | 
391     Msg = receive                          |         | 
392         A -> A                             |         | 
393     after 10 ->                            |         | 
394         default                            |         | 
395     end,                                   |         | 
396     {Msg}.                                 |         | {Msg}. Expected: atom(), Got: {'default' | 'atom'}
397                                            |         | 
398 -spec test83_pos(integer()) -> atom().     |         | 
399 test83_pos(Timeout) ->                     | OK      | 
400     receive                                |         | 
401         _ -> atom                          |         | 
402     after Timeout ->                       |         | 
403         default                            |         | 
404     end.                                   |         | 
405                                            |         | 
406 -spec test84_pos() -> number().            |         | 
407 test84_pos() ->                            | OK      | 
408     begin                                  |         | 
409         Z = 2                              |         | 
410     end,                                   |         | 
411     Z.                                     |         | 
412                                            |         | 
413 -spec test85() -> atom().                  |         | 
414 test85() ->                                | OK      | 
415     receive                                |         | 
416         A when is_atom(A) -> A;            |         | 
417         X when is_number(X) -> number      |         | 
418     end.                                   |         | 
419                                            |         | 
420 -spec unzip1_neg([{integer(),atom()}])     |         | 
421         -> {[atom()], [integer()]}.        |         | 
422 unzip1_neg([]) -> {[],[]};                 | ERROR   | 
423 unzip1_neg([{H1, H2}|T]) ->                |         | 
424     {T1, T2} = unzip1_neg(T),              |         | 
425     {[H1|T1], [H2|T2]}.                    |         | {[H1 | T1], [H2 | T2]}. Expected: {[atom()], [number()]}, Got: {[number() | atom()], [atom() | number()]}
426                                            |         | 
427 -spec unzip2_neg([{integer(),atom()}])     |         | 
428     -> {[atom()] | [integer()],            |         | 
429         [atom()] | [integer()]}.           |         | 
430 unzip2_neg([]) -> {[],[]};                 | ERROR   | 
431 unzip2_neg([{H1, H2}|T]) ->                |         | 
432     {T1, T2} = unzip2_neg(T),              |         | 
433     {[H1|T1], [H2|T2]}.                    |         | {[H1 | T1], [H2 | T2]}. Expected: {[atom()] | [number()], [atom()] | [number()]}, Got: {[atom() | number()], [atom() |……
434                                            |         | 
435 -spec wrong_list_neg() -> any().           |         | 
436 wrong_list_neg() ->                        | ERROR   | 
437     X = [1 | 2],                           |         | number_expr. Expected: [term()], Got: number()
438     X.                                     |         | 
